{% extends "base.html" %}
{% load tags %}
{% block content %}

<div class="jumbotron">
    <h2 class="display-4">Znajdź kierunek studiów</h2>
    <p class="lead">System pomoże wybrać ci najbardziej dopasowany kierunek studiów. 
        <ul>
            <li class="lead">Najpierw zostaniesz poproszony o wybranie stopnia studiów.</li> 
            <li class="lead">Potem w przypadku szukania studiów I stopnia będziesz mógł uzupełnić które przedmioty zdawałeś na maturze. </li>
            <li class="lead">Finalnie zostanie ci kilkukrotnie wyświetlone 10 różnych tematyk które możesz zaznaczyć jeżeli ci się podobają. Na ich podstawie otrzymasz kilka najbardziej dopasowanych kierunków studiów</li> 
        </ul>
    </p>
    <hr class="my-4">
</div>

<div class="container my-3">
    <form method="post">
        {% csrf_token %}
        <div class="container mx-auto p-3 bg-white rounded border" style="max-width: 650px;">
            <h4 class="text-center pb-2">Wybierz pasujące do ciebie tematyki.</h4>
            <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="{{ progress }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ progress }}%;"></div>
            </div>
            <br>
            {% for attribute in attrs %}
              <div class="form-check d-flex align-items-center mb-3">
                  <input type="checkbox" class="form-check-input" id="{{ attribute.id }}" name="approved" value="{{ attribute.id }}">
                  <label class="form-check-label fs-5 ms-2" for="{{ attribute.id }}">{{ attribute.attribute }}</label>
                  <input type="hidden" name="all" value="{{ attribute.id }}">
              </div>
            {% endfor %}
            <hr class="my-4">
            <button type="submit" class="btn btn-primary btn-lg d-block mx-auto w-75 my-1">Zapisz i przejdź dalej</button> 
        </div>
    </form>
</div>

<script>
    // Set the progress variable from the Django template
    var progress = {{ progress }};

    $(document).ready(function () {
        $('#submitButton').click(function () {
            if (progress === 100) {
                // Load the loading_popup.html content using an AJAX request
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        // Insert the content into the loadingPopupContent div
                        document.getElementById("loadingPopupContent").innerHTML = this.responseText;
                        // Show the modal
                        $('#loadingModal').modal('show');
                    }
                };
                xhttp.open("GET", "discover_loading_page.html", true);
                xhttp.send();
            }
        });
    });
</script>
{% endblock %}